<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Actualités - BAC PRO CIEL</title>
<style>
body {
    font-family:"Comic Sans MS", cursive, sans-serif;
    background: linear-gradient(#a6d6f7, #5c69d6, #0a1530);
    color:white;
    margin:0;
    min-height:100vh;
    line-height:1.6;
}
.menu-bar {
    background:#4a66ff;
    padding:20px;
    box-shadow:0 5px 15px rgba(0,0,0,0.3);
}
.menu-bar ul {
    list-style:none;
    display:flex;
    gap:30px;
    justify-content:center;
    margin:0;
    padding:0;
}
.menu-bar li { position:relative; }
.menu-bar a {
    color:white;
    text-decoration:none;
    padding:15px 25px;
    display:block;
    border-radius:25px;
    font-size:22px;
    font-weight:bold;
    transition:0.3s;
}
.menu-bar a:hover { background:linear-gradient(135deg,#6e82ff,#8aa0ff); }
.dropdown-content {
    display:none;
    position:absolute;
    top:100%;
    left:0;
    background:linear-gradient(#3550ff,#2c3b85);
    min-width:200px;
    border-radius:12px;
    overflow:hidden;
    z-index:1000;
}
.dropdown-content a {
    padding:15px 20px;
    font-size:18px;
}
.dropdown:hover .dropdown-content { display:block; }

/* Grille 2 colonnes */
#newsContainer {
    width: 90%;
    margin: 30px auto;
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 20px;
}
/* News */
.newsItem {
    padding: 15px;
    border-radius: 12px;
    background: #222;
    display: flex;
    flex-direction: column;
    align-items: center;
    text-align: center;
}
.newsItem img {
    max-width: 100%;
    max-height: 400px;
    object-fit: cover;
    border-radius: 8px;
    margin-top: 10px;
}
.newsItem h3 { color:#4a66ff; margin-bottom:5px; }
.newsItem p, .newsItem a { color:#ccc; }

/* Bouton Modifier */
.newsItem button {
    margin-top: 10px;
    padding:8px 15px;
    border:none;
    border-radius:10px;
    background:#4a66ff;
    color:white;
    cursor:pointer;
    transition:0.3s;
    font-weight:bold;
}
.newsItem button:hover {
    background:#6e82ff;
}

/* Bulle ajout news */
#addNewsBubble {
    position:fixed;
    bottom:30px;
    right:30px;
    width:60px;
    height:60px;
    background:#4a66ff;
    border-radius:50%;
    display:flex;
    justify-content:center;
    align-items:center;
    font-size:30px;
    color:white;
    cursor:pointer;
    box-shadow:0 5px 15px rgba(0,0,0,0.3);
    z-index:1000;
}

/* Popups */
.login-popup {
    display:none;
    position:fixed;
    top:0; left:0;
    width:100%; height:100%;
    background:rgba(0,0,0,0.7);
    justify-content:center;
    align-items:center;
    z-index:2000;
}
.login-popup form {
    background:#111;
    padding:20px;
    border-radius:15px;
    width:400px;
    display:flex;
    flex-direction:column;
    gap:10px;
}
.login-popup input, .login-popup select, .login-popup textarea, .login-popup button {
    padding:10px; border-radius:8px; border:none; font-size:16px;
}
.login-popup button {
    background:#4a66ff; color:white; cursor:pointer; transition:0.3s;
}
.login-popup button:hover { background:#6e82ff; }
</style>
</head>
<body>

<!-- Menu -->
<header class="menu-bar">
  <ul>
    <li class="dropdown">
      <a href="menu.html">Menu</a>
      <div class="dropdown-content">
        <a href="Cybersécurité.html">Cybersécurité</a>
        <a href="informatique.html">Informatique</a>
        <a href="éléctronique.html">Électronique</a>
      </div>
    </li>
    <li class="dropdown">
      <a href="#">Compte</a>
      <div class="dropdown-content">
        <a href="#" id="signupBtn">Créer un compte</a>
        <a href="#" id="loginBtn">Connexion</a>
        <a href="#" id="logoutBtn" style="display:none;">Déconnexion</a>
      </div>
    </li>
    <li class="dropdown" id="adminMenu" style="display:none;">
      <a href="#">Admin</a>
      <div class="dropdown-content">
        <a href="#" id="openNewsManager">Gestion des news</a>
      </div>
    </li>
  </ul>
</header>

<h1 style="text-align:center;margin-top:30px;">Actualités</h1>
<div id="newsContainer"></div>

<!-- Bulle ajout news -->
<div id="addNewsBubble">+</div>

<!-- Popup ajout news / modification -->
<div class="login-popup" id="newsPopup">
    <form id="formAddNews">
        <h2 id="newsFormTitle">Nouvelle Actualité</h2>
        <input type="text" id="newsTitle" placeholder="Titre de l'actualité">
        <textarea id="newsDesc" placeholder="Description"></textarea>
        <input type="file" id="newsImgFile" accept="image/*">
        <input type="text" id="newsImgUrl" placeholder="URL de l'image (optionnel)">
        <input type="text" id="newsUrl" placeholder="URL de redirection (optionnel)">
        <button type="submit">Enregistrer</button>
        <button type="button" id="closeNewsPopup">Annuler</button>
    </form>
</div>

<!-- Popups Connexion / Création compte -->
<div class="login-popup" id="loginForm">
    <form id="formLogin">
        <h2>Connexion</h2>
        <input type="text" id="loginUsername" placeholder="Nom d'utilisateur" required>
        <input type="password" id="loginPassword" placeholder="Mot de passe" required>
        <button type="submit">Se connecter</button>
        <button type="button" id="closeLogin">Fermer</button>
    </form>
</div>

<div class="login-popup" id="signupForm">
    <form id="formSignup">
        <h2>Créer un compte</h2>
        <input type="text" id="signupPrenom" placeholder="Prénom" required>
        <input type="text" id="signupNom" placeholder="Nom" required>
        <input type="email" id="signupEmail" placeholder="Email" required>
        <input type="text" id="signupUsername" placeholder="Nom d'utilisateur" required>
        <input type="password" id="signupPassword" placeholder="Mot de passe" required>
        <select id="signupRole">
            <option value="client">Client</option>
            <option value="admin">Admin</option>
        </select>
        <button type="submit">Créer</button>
        <button type="button" id="closeSignup">Fermer</button>
    </form>
</div>

<script>
const loginBtn = document.getElementById("loginBtn");
const logoutBtn = document.getElementById("logoutBtn");
const loginForm = document.getElementById("loginForm");
const signupForm = document.getElementById("signupForm");
const closeLogin = document.getElementById("closeLogin");
const closeSignup = document.getElementById("closeSignup");
const addNewsBubble = document.getElementById('addNewsBubble');
const newsPopup = document.getElementById('newsPopup');
const closeNewsPopup = document.getElementById('closeNewsPopup');
const formAddNews = document.getElementById('formAddNews');
const newsContainer = document.getElementById('newsContainer');
const newsFormTitle = document.getElementById('newsFormTitle');

let editingIndex = null;
let isAdmin = false;

// Popups
loginBtn.addEventListener("click", ()=> loginForm.style.display="flex");
closeLogin.addEventListener("click", ()=> loginForm.style.display="none");
document.getElementById("signupBtn").addEventListener("click", ()=> signupForm.style.display="flex");
closeSignup.addEventListener("click", ()=> signupForm.style.display="none");

// Création compte
document.getElementById("formSignup").addEventListener("submit", function(e){
    e.preventDefault();
    const prenom = document.getElementById("signupPrenom").value.trim();
    const nom = document.getElementById("signupNom").value.trim();
    const email = document.getElementById("signupEmail").value.trim();
    const username = document.getElementById("signupUsername").value.trim();
    const password = document.getElementById("signupPassword").value.trim();
    const role = document.getElementById("signupRole").value;

    if(localStorage.getItem(username)){
        alert("Nom d'utilisateur déjà utilisé !");
        return;
    }

    const user = { prenom, nom, email, username, password, role };
    localStorage.setItem(username, JSON.stringify(user));
    alert("Compte créé ! Vous pouvez vous connecter.");
    signupForm.style.display="none";
});

// Connexion
document.getElementById("formLogin").addEventListener("submit", function(e){
    e.preventDefault();
    const username = document.getElementById("loginUsername").value.trim();
    const password = document.getElementById("loginPassword").value.trim();
    const stored = localStorage.getItem(username);
    if(!stored){ alert("Utilisateur non trouvé !"); return; }
    const user = JSON.parse(stored);
    if(user.password !== password){ alert("Mot de passe incorrect !"); return; }

    sessionStorage.setItem("loggedUser", username);
    alert(`Connexion réussie ! Bienvenue ${user.prenom} ${user.nom}`);
    loginForm.style.display="none";
    loginBtn.style.display="none";
    logoutBtn.style.display="inline-block";

    if(user.role==="admin"){
        document.getElementById('adminMenu').style.display='block';
        addNewsBubble.style.display='flex';
        isAdmin = true;
    } else {
        isAdmin = false;
    }
    loadNews();
});

// Déconnexion
logoutBtn.addEventListener("click", ()=>{
    sessionStorage.removeItem("loggedUser");
    loginBtn.style.display="inline-block";
    logoutBtn.style.display="none";
    document.getElementById('adminMenu').style.display='none';
    addNewsBubble.style.display='none';
    isAdmin = false;
    loadNews();
});

// Bulle ajout news
addNewsBubble.addEventListener('click', ()=>{
    newsFormTitle.textContent = "Nouvelle Actualité";
    formAddNews.reset();
    editingIndex = null;
    newsPopup.style.display='flex';
});
closeNewsPopup.addEventListener('click', ()=> newsPopup.style.display='none');

// Ajouter / Modifier news
formAddNews.addEventListener('submit', (e)=>{
    e.preventDefault();
    if(!isAdmin){ alert("Seuls les admins peuvent modifier/ajouter"); return; }
    const title = document.getElementById('newsTitle').value.trim();
    const desc = document.getElementById('newsDesc').value.trim();
    const fileInput = document.getElementById('newsImgFile');
    const urlInput = document.getElementById('newsImgUrl').value.trim();
    const linkUrl = document.getElementById('newsUrl').value.trim();

    if(!title && !desc && !fileInput.files[0] && !urlInput) return alert("Rien à enregistrer !");

    const newsList = JSON.parse(localStorage.getItem('news')||'[]');

    function saveNews(imgData){
        const newsItem = { title, desc, imgData, url: linkUrl };
        if(editingIndex!==null){
            newsList[editingIndex] = newsItem;
        } else {
            newsList.unshift(newsItem);
        }
        localStorage.setItem('news', JSON.stringify(newsList));
        loadNews();
        formAddNews.reset();
        newsPopup.style.display='none';
    }

    if(fileInput.files[0]){
        const reader = new FileReader();
        reader.onload = function(evt){
            saveNews(evt.target.result);
        }
        reader.readAsDataURL(fileInput.files[0]);
    } else if(urlInput){
        saveNews(urlInput);
    } else {
        saveNews('');
    }
});

// Affichage news
function displayNews(newsList){
    newsContainer.innerHTML = '';
    if(newsList.length === 0){ newsContainer.innerHTML = '<p>Aucune actualité pour le moment.</p>'; return; }
    newsList.forEach((item, index)=>{
        const div = document.createElement('div');
        div.className = 'newsItem';
        let imgHTML = item.imgData ? `<img src="${item.imgData}" alt="image">` : '';
        let linkHTML = item.url ? `<p><a href="${item.url}" target="_blank" style="color:#4a66ff;">Voir l'article</a></p>` : '';
        let modifyButton = isAdmin ? `<button onclick="editNews(${index})">Modifier</button>` : '';
        div.innerHTML = `
            <h3>${item.title}</h3>
            <p>${item.desc}</p>
            ${imgHTML}
            ${linkHTML}
            ${modifyButton}
        `;
        newsContainer.appendChild(div);
    });
}

function loadNews(){
    const newsList = JSON.parse(localStorage.getItem('news')||'[]');
    displayNews(newsList);
}

// Modifier news
function editNews(index){
    if(!isAdmin){ alert("Seuls les admins peuvent modifier"); return; }
    const newsList = JSON.parse(localStorage.getItem('news')||'[]');
    const item = newsList[index];
    editingIndex = index;
    newsFormTitle.textContent = "Modifier Actualité";
    document.getElementById('newsTitle').value = item.title;
    document.getElementById('newsDesc').value = item.desc;
    document.getElementById('newsImgUrl').value = item.imgData||'';
    document.getElementById('newsUrl').value = item.url||'';
    newsPopup.style.display = 'flex';
}

// Au chargement
window.onload = ()=>{
    const username = sessionStorage.getItem("loggedUser");
    if(username){
        const user = JSON.parse(localStorage.getItem(username));
        if(user && user.role==="admin"){
            addNewsBubble.style.display='flex';
            document.getElementById('adminMenu').style.display='block';
            isAdmin = true;
        } else {
            addNewsBubble.style.display='none';
            document.getElementById('adminMenu').style.display='none';
            isAdmin = false;
        }
        loginBtn.style.display='none';
        logoutBtn.style.display='inline-block';
    } else {
        addNewsBubble.style.display='none';
        document.getElementById('adminMenu').style.display='none';
        isAdmin = false;
    }
    loadNews();
};
</script>

</body>
</html>
